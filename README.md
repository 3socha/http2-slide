# HTTP/2 の話
## f TECH MEETUP #1 LT
## 2018/1/13
## so

---

## `$ whoami`

![so](img/so.png)

- so ([@3socha](https://twitter.com/3socha))
- インフラエンジニア (AWS/Azure)
- シェル芸人

---

## 何故今更 HTTP/2

- [dev.to](https://dev.to) を見てて、Web ってこんなに高速化できるんだと感動した
- Web を高速化させるためのいろんな仕組みを学ぶ手始めに

---

## HTTP/2 の歴史

- 2012/12 SPDY を元に IETF ワーキンググループでドラフト公開
- 2015/02 IETF で仕様として承認
- 2015/05 RFC 7540 として正式に文書化

---

- 2015/09 Nginx 1.9.5 で HTTP/2 サポート
- 2015/10 Apache 2.4.17 で HTTP/2 サポート (mod_http2)

---

- 2016/04 Let's Encrypt が正式サービス化
    - HTTP/2 は TLS がほぼ必須

---

- 2016/01 ACM がリリース、AWS で使える TLS 証明書の発行が可能に
- 2016/09 AWS CloudFront が HTTP/2 対応
- 2016/12 AWS で HTTP/2 対応の L7 ロードバランサ (ALB) 発表
- 2017/12 ACM で DNS 検証による TLS 証明書発行が可能に
    - とても楽になった

---

## AWS で HTTP/2 が使いやすくなったので！
## Web をもっと早くして、ユーザー体験を向上させたい

---

## HTTP 1.1 の課題

- TCP ストリーム数の上限が少ない
    - HTTP 1.1 の仕様は 2, Chrome は 6 程度
    - 大量のリソースの読み込みに時間がかかる
- HTTP HoL (head of line) ブロッキング
    - 先行するリクエストが詰まると、後続のレスポンスも詰まる

---

## HTTP 1.1 での高速化技術

- ドメインシャーディング
    - 別のドメイン (CDN) にリソースを配置
- CSS スプライト
    - 複数の小さな画像を 1 つにまとめて TCP ストリームを節約
- 画像のインライン埋め込み
    - Base64 エンコードした画像を HTML に直接埋め込み

---

## HTTP/2 概要

HTTP の高速化

- HTTP ヘッダの圧縮
    - 2 回目以降の通信は差分のみ
- ストリームの多重化
    - 1 つの TCP 接続上に仮想的なストリームを作成
- ストリームの優先度
    - 初期ページのレンダリングに必須のデータを優先して送る
- HTTP/2 サーバープッシュ
    - リクエストを待たず、コンテンツをサーバー側から送信

---

## Reverse Proxy と HTTP/2

- ロードバランサ (Reverse Proxy) で TLS を終端する構成がよくある
- ロードバランサ - サーバー間の通信は HTTP 1.1 に

```
[Client]---<Internet:HTTP/2>---[Reverse Proxy]-<HTTP 1.1>-[Server]
```

- 一番時間のかかるインターネット部分のストリームは多重化されるため、パフォーマンスへの影響はあまりない
- HTTP/2 サーバープッシュは使えないが...
    - HTTP 1.1 の仕組みを利用して Reverse Proxy が HTTP/2 サーバープッシュする方法もある
        - Server が Link ヘッダで Reverse Proxy にサブリソースの存在を伝える
        - HTTP 103 Early Hints (提案段階)

---

## まとめ

- HTTP/2 は HTTP 1.1 に対して後方互換性があるため、特に設定しなくても問題なく動くが
- ちゃんと理解して活用することで、ユーザー体験を向上させることができる、はず!
- 既にお手軽に使えるようになってので、積極的に使っていきたい

---

## おまけ

- HTTP/2 の日本語情報が多くて嬉しい
- 仕様策定段階で、日本の HTTP/2 コミュニティの活動が活発で、様々な実装が作られた
- RFC 7540 の末尾に謝辞が書かれてる
